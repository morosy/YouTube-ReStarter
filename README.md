# YouTube-Reset

YouTube の動画を **必ず 0:00 から再生**するための Chrome 拡張機能です．  
YouTube の SPA（Single Page Application）構造に対応し，  
動画遷移時に自動で再生位置をリセットします．  

ver 1.3 系より，**高度な設定画面とポップアップカスタマイズ機能**を実装しています．

---

## 機能概要

- YouTube の動画を **必ず 0:00 から再生**
- SPA 遷移対応（関連動画クリック，戻る/進む）
- 完了時に **中央上部へトースト通知**
- 拡張機能アイコンから **ON / OFF 切替**
- OFF → ON 操作時の誤動作防止（再生中の動画には適用しない）
- 設定画面による詳細カスタマイズ
- 未保存状態インジケータ（●）

---

## 対応ページ

- `https://www.youtube.com/watch?v=[ID]`

※ 現在は `/watch` ページのみ対象  
（Shorts や埋め込み動画は未対応）

---

## 設定画面（ver 1.3 以降）

ポップアップの設定ボタンから設定タブを開くことができます．  

### 基本設定

- 有効化（ON / OFF）
- ポップアップ表示 ON / OFF

### 詳細設定（ポップアップ ON のとき表示）

- ポップアップ位置  
  - 左上  
  - 中央  
  - 右上
- ポップアップの大きさ（スライダー）
- 表示時間（1～10秒）
- 背景色設定（テンプレカラー＋カラーピッカー）
- フォントカラー設定（テンプレカラー＋カラーピッカー）
- プレビューボタン

### 保存仕様

- 変更時は保存されない
- 「設定を保存」ボタン押下時にのみ保存
- 未保存状態は ● で表示
- 保存完了時は中央上部に  
  `設定を保存しました` と表示

---

## インストール方法（開発用）

1. このリポジトリをダウンロード，またはクローン
2. Chrome で以下を開く  

`chrome://extensions/`

3. 右上の **「デベロッパーモード」** を ON
4. **「パッケージ化されていない拡張機能を読み込む」**
5. `YouTube-Reset` フォルダを選択

---

## 使い方

### 基本動作

- ON の状態で YouTube の動画ページを開く
- 動画が **自動的に 0:00 に戻る**
- 処理完了後，トースト通知を表示（設定に従う）

### ON / OFF 切替

- Chrome 右上の拡張機能アイコンをクリック
- トグルスイッチで有効 / 無効を切替

#### OFF 時の挙動

- 動画は一切リセットされない
- トーストも表示されない

#### OFF → ON 時の挙動

- 切り替えた瞬間に再生中の動画には適用されない
- 次の動画遷移から有効

---

## ディレクトリ構成

```
YouTube-Reset/
├── manifest.json
├── content.js
├── toast.css
├── popup.html
├── popup.js
├── popup.css
├── options.html
├── options.js
├── options.css
└── README.md
```

---

## 技術仕様

- Chrome Extensions Manifest V3
- Content Script による制御
- YouTube SPA 対応  
  - History API（`pushState`，`replaceState`）
  - `yt-navigate-finish` イベント
  - `MutationObserver`
- 設定保存  
  - `chrome.storage.local`
- 再生制御  
  - `HTMLVideoElement.currentTime = 0`

---

## 実装上の工夫

### 非同期イベント対策

YouTube は以下のような非同期処理を多用しています．

- `setTimeout`
- `loadedmetadata`
- `playing`
- DOM 差し替え（Mutation）

これにより，単純な ON / OFF フラグでは  
OFF 中でも処理が走る問題が発生します．  

本拡張では，

- 実行直前に設定を再確認
- OFF / ON 切替時の世代管理
- 予約済み処理のキャンセル

を実装し，  

- OFF 中は実行されない
- OFF → ON の誤動作が起きない

ことを保証しています．

---

## 変更履歴
<details>
<summary>
変更履歴
</summary>

- v1.0.0 初回リリース．動画を常に 0:00 から再生．YouTube SPA 遷移対応． 2026/02/08
- v1.1.0 実行完了時のトースト通知を追加．通知の自動フェードアウトを実装． 2026/02/09
- v1.2.0 拡張機能アイコンからの ON / OFF トグルを追加．設定保存を導入． 2026/02/10
- v1.2.1 OFF → ON 操作時の再生中動画への誤適用を修正． 2026/02/10
- v1.2.2 OFF 状態でも実行される問題を修正．世代管理を導入． 2026/02/11
- v1.3.0 設定画面を追加．ポップアップ詳細設定を実装． 2026/02/12
- v1.3.1 ポップアップの色・サイズ・表示時間カスタマイズ機能を追加． 2026/02/12
- v1.3.2 保存ボタン方式に変更．未保存インジケータ（●）を追加． 2026/02/12
- v1.3.3 storage.sync から storage.local へ移行．quota エラーを解消． 2026/02/12
- v1.3.4 popup 初期化処理の安定化．DOM 未生成時の null エラーを修正． 2026/02/12

</details>

---

## 注意事項

- 拡張機能を更新した後は  
  **YouTube タブをリロード（推奨：スーパーリロード）**してください
- YouTube 側の仕様変更により動作しなくなる可能性があります

---

## 今後の予定

- Shorts（`/shorts/`）対応
- プレイリスト再生時の挙動切替
- 手動リセットボタン追加
- Chrome Web Store 公開対応

---

## ライセンス

MIT License

---

## 作者

設計・開発：Shunsuke MOROZUMI
